<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-KyZXEAg3QhqLMpG8r+Knujsl5+5hb7O1RZ3rYbYz2v8xB0c1dM3b5LrWYY7j2hz9L5Jq1Y8uF+XyOaG2vVt8wg==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<div class="personas-main-content" style="background:#ffffff; font-family:'Montserrat', sans-serif;">
  <?php if (isset($_GET['debugcms']) && $_GET['debugcms'] == '1') { ?>
    <?php if (isset($this->debug_bloque54)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B54: <?php echo htmlspecialchars(json_encode($this->debug_bloque54, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_bloque55)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B55: <?php echo htmlspecialchars(json_encode($this->debug_bloque55, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_bloque56)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B56: <?php echo htmlspecialchars(json_encode($this->debug_bloque56, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_bloque57)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B57: <?php echo htmlspecialchars(json_encode($this->debug_bloque57, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
  <?php } ?>
  <!-- BANNER -->
  <?php if (!empty($this->port_banner)) { ?>
  <div style="position: relative; max-width: 100%; overflow: hidden; margin-top: 0;">
    <div style="display: block; width: 100%;">
      <?php $href = isset($this->port_banner_link) ? trim((string)$this->port_banner_link) : ''; ?>
      <?php if ($href) { ?><a href="<?php echo htmlspecialchars($href); ?>" style="display:block;"><?php } ?>
      <img src="<?php echo htmlspecialchars($this->port_banner); ?>" style="width: 100%; height: 300px; object-fit: cover; display: block;">
      <?php if ($href) { ?></a><?php } ?>
    </div>
  </div>
  <?php } else { ?>
  <div style="position: relative; max-width: 100%; overflow: hidden; margin-top: 0; min-height: 300px; border-radius:12px; background:linear-gradient(180deg,#eef5fb 0%,#e6eef7 100%); border:1px solid #d9e5f0; box-shadow:0 6px 18px rgba(15, 23, 42, 0.05);"></div>
  <?php } ?>
  <!-- TEXTO (dinámico desde CMS: Bloque 23 -> titulo[0]) -->
  <?php $mintText = $this->port_vc['titulo'][0] ?? null; ?>
  <?php if (!empty($mintText)) { ?>
  <p style="font-size: 22px; font-weight: 700; color:#0ea5a6; text-align: center; line-height: 1.9; letter-spacing:0.2px; max-width: 900px; margin: 40px auto 12px;">
    <?php echo htmlspecialchars((string)$mintText); ?>
  </p>
  <?php } else { ?>
  <div style="max-width:900px; margin:40px auto 12px; display:flex; flex-direction:column; gap:8px; align-items:center;">
    <span style="display:block; width:80%; height:22px; border-radius:8px; background:linear-gradient(90deg,#eef5fb 0%,#e6eef7 50%,#eef5fb 100%); background-size:200px 100%; animation:shine 1.2s linear infinite; opacity:.8;"></span>
    <span style="display:block; width:60%; height:22px; border-radius:8px; background:linear-gradient(90deg,#eef5fb 0%,#e6eef7 50%,#eef5fb 100%); background-size:200px 100%; animation:shine 1.2s linear infinite; opacity:.8;"></span>
  </div>
  <style>
    @keyframes shine { from { background-position:-200px 0; } to { background-position:200px 0; } }
  </style>
  <?php } ?>
  <div style="width:52px; height:3px; background:#0ea5a6; opacity:.25; margin:0 auto 28px; border-radius:2px;"></div>
  <!-- VIDEO -->
  <div class="container" style="margin-top: 60px; margin-bottom: 60px;">
    
    <div class="d-flex flex-wrap justify-content-center align-items-center text-center" style="gap: 60px;">
      <?php if (!empty($this->port_vc['video'][0])) { ?>
      <div style="flex: 1 1 600px; max-width: 600px;">
        <?php 
          $v = trim((string)$this->port_vc['video'][0]);
          $v = preg_replace('#^http:#i','https:',$v);
          if (preg_match('#youtu\.be/([\w-]+)#i',$v,$m)) { $v = 'https://www.youtube.com/embed/'.$m[1]; }
          elseif (preg_match('#youtube\.com/(?:watch\?v=|shorts/)([\w-]+)#i',$v,$m)) { $v = 'https://www.youtube.com/embed/'.$m[1]; }
        ?>
        <iframe id="videoimei"
          width="100%"
          height="340"
          src="<?php echo htmlspecialchars($v); ?>"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          style="border-radius: 16px; box-shadow: 0 8px 16px rgba(0,0,0,0.1);">
        </iframe>
      </div>
      <?php } else { ?>
      <div style="flex: 1 1 600px; max-width: 600px; position: relative;">
        <div style="width:100%; height:340px; background:linear-gradient(180deg,#eef5fb 0%,#e6eef7 100%); border:1px solid #d9e5f0; border-radius:16px; box-shadow:0 6px 18px rgba(15, 23, 42, 0.05);"></div>
      </div>
      <?php } ?>
      <!-- CARRUSEL -->
      <?php 
        $imgsRaw = isset($this->port_vc['imagen']) && is_array($this->port_vc['imagen']) ? $this->port_vc['imagen'] : [];
        // Normaliza posibles filas tipo array (imagen/url)
        $imgs = [];
        foreach ($imgsRaw as $it) {
          if (is_array($it)) {
            $src = $it['imagen'] ?? ($it['url'] ?? null);
            if (!$src && !empty($it)) { $first = reset($it); if (is_string($first)) $src = $first; }
            if ($src) $imgs[] = $src;
          } elseif (is_string($it)) { $imgs[] = $it; }
        }
      ?>
      <?php if (!empty($imgs)) { ?>
      <div style="flex: 1 1 500px; max-width: 500px; position: relative;">
        <style>
          /* Visibilidad sin dependencias de Bootstrap */
          #portCarousel .carousel-item { display: none; position: relative !important; transition: none !important; transform: none !important; left: 0 !important; }
          #portCarousel .carousel-item.active { display: block; transition: none !important; transform: none !important; }
          /* Anula estados de transición de Bootstrap si su CSS está cargado globalmente */
          #portCarousel .carousel-item-next,
          #portCarousel .carousel-item-prev,
          #portCarousel .carousel-item-start,
          #portCarousel .carousel-item-end { transition: none !important; transform: none !important; }
          #portCarousel .carousel-inner { position: relative; overflow: hidden; }
          #portCarousel .visually-hidden { position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
          /* Controles: dentro del carrusel */
          #portCarousel .carousel-control-prev,
          #portCarousel .carousel-control-next { position:absolute; top:50%; transform:translateY(-50%); width:auto; height:auto; background:transparent; border:none; padding:0; color:inherit; box-shadow:none; }
          #portCarousel .carousel-control-prev { left:8px; }
          #portCarousel .carousel-control-next { right:8px; }
          @media (min-width: 576px) {
            #portCarousel .carousel-control-prev { left:-24px; }
            #portCarousel .carousel-control-next { right:-24px; }
          }
          @media (min-width: 992px) {
            #portCarousel .carousel-control-prev { left:-40px; }
            #portCarousel .carousel-control-next { right:-40px; }
          }
          #portCarousel .carousel-control-prev:focus,
          #portCarousel .carousel-control-next:focus { outline:none; box-shadow:none; }
        </style>
        <div id="portCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000" style="position: relative; overflow: visible;">
          <div class="carousel-inner">
            <?php foreach ($imgs as $i => $src) { $active = $i===0 ? ' active' : ''; ?>
              <div class="carousel-item<?php echo $active; ?>">
                <img src="<?php echo htmlspecialchars($src); ?>" alt="Imagen <?php echo $i+1; ?>"
                  style="display: block; margin: 0 auto; width: 100%; max-height: 340px; object-fit: contain; border-radius: 16px; box-shadow: 0 8px 16px rgba(0,0,0,0.1);">
              </div>
            <?php } ?>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#portCarousel" data-bs-slide="prev" style="display:flex;align-items:center;justify-content:center;z-index:3;">
            <i class="fa fa-arrow-left" style="color:#0ea5a6; font-size: 26px; background: #fff; padding: 10px; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.2);"></i>
            <span class="visually-hidden">Anterior</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#portCarousel" data-bs-slide="next" style="display:flex;align-items:center;justify-content:center;z-index:3;">
            <i class="fa fa-arrow-right" style="color:#0ea5a6; font-size: 26px; background: #fff; padding: 10px; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.2);"></i>
            <span class="visually-hidden">Siguiente</span>
          </button>
        </div>
        <script>
          (function(){
            var el = document.getElementById('portCarousel');
            if (!el) return;
            var items = el.querySelectorAll('.carousel-item');
            if (!items.length) return;
            var prev = document.querySelector('[data-bs-target="#portCarousel"][data-bs-slide="prev"]');
            var next = document.querySelector('[data-bs-target="#portCarousel"][data-bs-slide="next"]');
            var idx = 0;
            function applyState(i){
              for (var k=0;k<items.length;k++){
                if (k===i){ items[k].classList.add('active'); items[k].style.display='block'; }
                else { items[k].classList.remove('active'); items[k].style.display='none'; }
              }
            }
            function go(dir){ idx = dir==='prev' ? (idx-1+items.length)%items.length : (idx+1)%items.length; applyState(idx); }
            // init
            applyState(0);
            if (prev) prev.addEventListener('click', function(e){ e.preventDefault(); go('prev'); });
            if (next) next.addEventListener('click', function(e){ e.preventDefault(); go('next'); });
            // autoplay
            var timer = setInterval(function(){ go('next'); }, 5000);
            el.addEventListener('mouseenter', function(){ clearInterval(timer); });
            el.addEventListener('mouseleave', function(){ timer = setInterval(function(){ go('next'); }, 5000); });
          })();
        </script>
      </div>
      <?php } else { ?>
      <div style="flex: 1 1 500px; max-width: 500px; position: relative;">
        <div style="width:100%; height:340px; background:linear-gradient(180deg,#eef5fb 0%,#e6eef7 100%); border:1px solid #d9e5f0; border-radius:16px; box-shadow:0 6px 18px rgba(15, 23, 42, 0.05);"></div>
      </div>
      <?php } ?>
    </div>
  </div>
  <!-- CONTENEDOR GENERAL -->
  <div style="background: #f8fafc; padding: 60px 20px;">
    
    <!-- TÍTULO -->
    <div style="text-align:center; margin-bottom: 28px;">
      <h2 style="color:#0ea5a6; font-weight: 800; font-size: 34px; margin:0 0 8px; letter-spacing:0.3px;">
        Ingresa los siguientes datos para tu portabilidad
      </h2>
      <div style="width:52px; height:3px; background:#0ea5a6; opacity:.25; margin:0 auto 12px; border-radius:2px;"></div>
      <p style="color: #556070; font-size: 16px; line-height:1.8;">Completa los campos para procesar tu solicitud</p>
    </div>

    <!-- SECCIÓN FORMULARIO -->
    <div style="max-width: 1100px; margin: auto; display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; align-items: flex-start;">
      <!-- COLUMNA IZQUIERDA -->
      <div style="flex: 1 1 320px; background: #fff; border-radius: 16px; padding: 30px; box-shadow: 0 8px 20px rgba(2,12,27,0.06); text-align: center; border:1px solid #eceff3;">
        <h3 style="font-size: 20px; font-weight: 800; color: #0ea5a6; margin-bottom: 10px;">
          ¿Cuál es mi ICC?
        </h3>
        <?php 
          $iccImg = null; $iccImgSource = null; $iccHref = null;
          if (!empty($this->port_icc_img)) { $iccImg = $this->port_icc_img; $iccImgSource='custom'; }
          elseif (!empty($this->port_datos_banner)) { $iccImg = $this->port_datos_banner; $iccImgSource='b24'; }
          elseif (isset($this->port_icc['imagen'][0]) && !empty($this->port_icc['imagen'][0])) { $iccImg = $this->port_icc['imagen'][0]; $iccImgSource='b21'; }
          if ($iccImgSource==='b24' && !empty($this->port_datos_banner_link)) { $iccHref = trim((string)$this->port_datos_banner_link); }
        ?>
        <?php if (!empty($iccImg)) { ?>
        <?php if (!empty($iccHref)) { ?><a href="<?php echo htmlspecialchars($iccHref); ?>" style="display:inline-block;"><?php } ?>
        <img src="<?php echo htmlspecialchars($iccImg); ?>" alt="Ejemplo ICC" style="max-width: 100%; border-radius: 12px; box-shadow: 0 8px 18px rgba(2,12,27,0.10);">
        <?php if (!empty($iccHref)) { ?></a><?php } ?>
        <?php } else { ?>
        <div style="width:100%; height:220px; border-radius:12px; background:linear-gradient(180deg,#eef5fb 0%,#e6eef7 100%); border:1px solid #d9e5f0; box-shadow:0 6px 18px rgba(15, 23, 42, 0.05);"></div>
        <?php } ?>
      </div>
      <!-- COLUMNA DERECHA (FORMULARIO) -->
      <div style="flex: 1 1 600px; background: #fff; border-radius: 16px; padding: 36px 32px; box-shadow: 0 8px 20px rgba(2,12,27,0.06); border:1px solid #eceff3;">
        <form method="post" id="frm_nuevo">
          <!-- CAMPO NOMBRE -->
          <div style="margin-bottom: 22px;">
            <label style="font-weight: 700; color: #0f172a; margin-bottom: 6px; display: block;">Nombre completo</label>
            <input type="text" name="x1" id="x1" placeholder="Ejemplo: Juan Pérez" required
              style="width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; font-size: 15px; outline: none; transition:border-color .25s; box-shadow:0 1px 2px rgba(0,0,0,0.04);" onfocus="this.style.borderColor='#17a2b8'" onblur="this.style.borderColor='#e5e7eb'">
          </div>
          <!-- CAMPO CORREO -->
          <div style="margin-bottom: 22px;">
            <label style="font-weight: 700; color: #0f172a; margin-bottom: 6px; display: block;">Correo electrónico</label>
            <input type="email" name="x2" id="x2" placeholder="correo@ejemplo.com" required
              style="width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; font-size: 15px; outline: none; transition:border-color .25s; box-shadow:0 1px 2px rgba(0,0,0,0.04);" onfocus="this.style.borderColor='#17a2b8'" onblur="this.style.borderColor='#e5e7eb'">
          </div>
          <!-- CAMPO TELÉFONO -->
          <div style="margin-bottom: 22px;">
            <label style="font-weight: 700; color: #0f172a; margin-bottom: 6px; display: block;">Número telefónico</label>
            <input type="text" name="x3" id="x3" placeholder="Ejemplo: 5512345678" required
              style="width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; font-size: 15px; outline: none; transition:border-color .25s; box-shadow:0 1px 2px rgba(0,0,0,0.04);" onfocus="this.style.borderColor='#17a2b8'" onblur="this.style.borderColor='#e5e7eb'">
          </div>
          <!-- CAMPO ICC -->
          <div style="margin-bottom: 22px;">
            <label style="font-weight: 700; color: #0f172a; margin-bottom: 6px; display: block;">ICC</label>
            <input type="text" name="x4" id="x4" placeholder="Ejemplo: 8952031234567890123" required
              style="width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; font-size: 15px; outline: none; transition:border-color .25s; box-shadow:0 1px 2px rgba(0,0,0,0.04);" onfocus="this.style.borderColor='#17a2b8'" onblur="this.style.borderColor='#e5e7eb'">
          </div>
          <!-- CAMPO NIP -->
          <div style="margin-bottom: 25px;">
            <label style="font-weight: 700; color: #0f172a; margin-bottom: 6px; display: block;">NIP</label>
            <input type="text" name="x5" id="x5" placeholder="Ejemplo: 1234" required
              style="width: 100%; padding: 12px 14px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; font-size: 15px; outline: none; transition:border-color .25s; box-shadow:0 1px 2px rgba(0,0,0,0.04);" onfocus="this.style.borderColor='#17a2b8'" onblur="this.style.borderColor='#e5e7eb'">
            <p style="font-size: 14px; color: #556070; margin-top: 8px;">
              Para obtener tu NIP envía un SMS al <b>051</b> con la palabra <b>NIP</b> desde el número que deseas portar.
            </p>
          </div>
          <!-- BOTÓN -->
          <div style="text-align: center; margin-top: 10px;">
            <button type="submit"
              style="background:#17a2b8; border: none; color: #fff; padding: 12px 40px; border-radius: 6px; font-weight: 700; font-size: 16px; letter-spacing: 0.2px; cursor: pointer; box-shadow: 0 6px 16px rgba(23,162,184,0.20); transition: background .25s, transform .15s;" onmouseover="this.style.background='#128a99'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='#17a2b8'; this.style.transform='translateY(0)';">
              Enviar solicitud
            </button>
          </div>

        </form>
      </div>
    </div>
    <!-- CONSULTAR ESTATUS -->
    <div style="margin-top: 60px; text-align: center;">
      <p style="color:#0f172a; font-weight:700; margin-bottom:8px;">Consultar estatus de tu portabilidad</p>
      <div style="display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap;">
        <input type="text" name="folio" id="folio" placeholder="Ingresa Folio"
          style="width: 300px; max-width: 90%; padding: 12px 14px; border-radius: 8px; border: 1px solid #e5e7eb; font-size: 15px; outline:none; transition:border-color .25s; box-shadow:0 1px 2px rgba(0,0,0,0.04);" onfocus="this.style.borderColor='#17a2b8'" onblur="this.style.borderColor='#e5e7eb'">
        <button
          style="background:#17a2b8; color: #fff; border: none; padding: 12px 26px; border-radius: 6px; font-weight: 700; cursor: pointer; transition: background .25s, transform .15s; box-shadow:0 6px 16px rgba(23,162,184,0.20);" onmouseover="this.style.background='#128a99'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='#17a2b8'; this.style.transform='translateY(0)';">
          Consultar
        </button>
      </div>
    </div>
    <!-- AYUDA -->
  <?php 
      // Construir WhatsApp igual que en Compatibilidad
      $waUrl = isset($this->port_ayuda_link) && is_string($this->port_ayuda_link) ? trim((string)$this->port_ayuda_link) : '';
      $waMsg = isset($this->port_ayuda_msg) && is_string($this->port_ayuda_msg) ? trim((string)$this->port_ayuda_msg) : '';
      $waNum = '';
      $scanValues = function($arr) use (&$waUrl,&$waNum,&$waMsg){
        foreach ($arr as $val){
          if (is_array($val)) { foreach ($val as $vv){ if (!is_string($vv)) continue; $s=trim($vv);
            if (!$waUrl && (stripos($s,'wa.me/')!==false || stripos($s,'whatsapp')!==false)) $waUrl=$s;
            if (!$waNum){ $d=preg_replace('/\D+/','',$s); if (strlen($d)>=8) $waNum=$d; }
            if (!$waMsg){ $isUrl=stripos($s,'http')===0||stripos($s,'wa.me/')!==false||stripos($s,'whatsapp')!==false; if(!$isUrl&&mb_strlen($s,'UTF-8')>=6) $waMsg=$s; }
          }}
          elseif (is_string($val)) { $s=trim($val);
            if (!$waUrl && (stripos($s,'wa.me/')!==false || stripos($s,'whatsapp')!==false)) $waUrl=$s;
            if (!$waNum){ $d=preg_replace('/\D+/','',$s); if (strlen($d)>=8) $waNum=$d; }
            if (!$waMsg){ $isUrl=stripos($s,'http')===0||stripos($s,'wa.me/')!==false||stripos($s,'whatsapp')!==false; if(!$isUrl&&mb_strlen($s,'UTF-8')>=6) $waMsg=$s; }
          }
        }
      };
      
      if (!$waUrl && isset($this->port_ayuda) && is_array($this->port_ayuda)) { $scanValues($this->port_ayuda); }
      if (!$waUrl && $waNum) { $waUrl = 'https://wa.me/'.$waNum; }
      if ($waUrl && stripos($waUrl,'http') !== 0) { $waUrl = 'https://'.$waUrl; }
      if ($waUrl && $waMsg) {
        if (stripos($waUrl,'wa.me/')!==false || stripos($waUrl,'api.whatsapp.com')!==false) {
          if (stripos($waUrl,'?text=')===false && stripos($waUrl,'&text=')===false) {
            $waUrl .= (strpos($waUrl,'?')===false ? '?' : '&').'text='.rawurlencode($waMsg);
          }
        }
      }
    ?>
    <div style="text-align: center; margin-top: 40px; display:flex; align-items:center; justify-content:center; gap:10px;">
      <span style="font-size:22px; font-weight:800; color:#0f172a;">¿Necesitas ayuda? Escríbenos</span>
      <?php if (!empty($waUrl)) { ?>
      <a href="<?php echo htmlspecialchars($waUrl); ?>" target="_blank" rel="noopener" title="WhatsApp"
         style="display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;background:#25D366;color:#fff;border-radius:50%; text-decoration:none;">
         <i class="fab fa-whatsapp" style="font-size:22px;color:#fff;"></i>
      </a>
      <?php } else { ?>
      <span style="display:inline-block; width:44px; height:44px; background:#e3e8ee; border-radius:50%;"></span>
      <?php } ?>
    </div>
  </div>
</div>
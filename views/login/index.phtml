<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  .personas-main-content{background:radial-gradient(120% 90% at 0% 0%, rgba(0,188,212,0.16) 0%, rgba(255,255,255,0) 60%), radial-gradient(120% 90% at 100% 0%, rgba(34,197,94,0.12) 0%, rgba(255,255,255,0) 58%), linear-gradient(180deg,#f6fbff 0%,#ffffff 55%,#f7fafc 100%) !important;}

  #frm_nuevo{position:relative; border:1px solid rgba(2,132,199,0.12) !important; box-shadow:0 20px 70px rgba(15,23,42,0.18) !important; overflow:hidden;}

  #frm_nuevo:before{content:""; position:absolute; inset:-80px -80px auto -80px; height:220px; background:radial-gradient(closest-side, rgba(0,188,212,0.22), rgba(255,255,255,0)); filter:blur(2px); pointer-events:none;}
  #frm_nuevo:after{content:""; position:absolute; right:-110px; bottom:-110px; width:240px; height:240px; background:radial-gradient(closest-side, rgba(34,197,94,0.18), rgba(255,255,255,0)); pointer-events:none;}

  #frm_nuevo .login-header{padding:18px 18px 16px; margin:-26px -24px 16px; background:linear-gradient(90deg,#00bcd4 0%,#06b6d4 35%,#22c55e 100%);}
  #frm_nuevo .login-title{margin:0; color:#ffffff; font-size:24px; font-weight:900; font-family:'Nunito',sans-serif; letter-spacing:-0.02em; text-align:center;}
  #frm_nuevo .login-sub{margin:8px 0 0; color:rgba(255,255,255,0.92); font-size:12px; line-height:1.4; text-align:center;}

  #frm_nuevo .field{position:relative; width:100%; margin:10px 0;}
  #frm_nuevo .field .field-ico{position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#64748b; font-size:14px;}

  #frm_nuevo input[type="email"],
  #frm_nuevo input[type="password"]{
    width:100% !important;
    padding:12px 42px 12px 38px !important;
    border:1px solid #e5e7eb !important;
    border-radius:14px !important;
    font-size:14px !important;
    outline:none !important;
    background:linear-gradient(180deg,#ffffff 0%,#fbfdff 100%) !important;
    box-shadow:0 1px 0 rgba(15,23,42,0.02) !important;
    transition:border-color .15s ease, box-shadow .15s ease, transform .08s ease;
  }

  #frm_nuevo input[type="email"]:focus,
  #frm_nuevo input[type="password"]:focus{
    border-color:rgba(0,188,212,0.95) !important;
    box-shadow:0 0 0 4px rgba(0,188,212,0.18) !important;
    background:#ffffff !important;
  }

  #frm_nuevo .toggle-password{border-radius:12px; transition:background-color .12s ease, color .12s ease;}
  #frm_nuevo .toggle-password:hover{background:rgba(148,163,184,0.18); color:#0f172a;}

  #frm_nuevo .btn-login{transition:transform .12s ease, filter .12s ease;}
  #frm_nuevo .btn-login:hover{filter:brightness(1.03); transform:translateY(-1px);}
  #frm_nuevo .btn-login:active{filter:brightness(0.98); transform:translateY(0);}
</style>
<div class="personas-main-content" style="background:#ffffff;">
<?php if (isset($_GET['debugcms']) && $_GET['debugcms']=='1') { ?>
  <?php if (isset($this->debug_bloque33)) { ?>
    <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B33: <?php echo htmlspecialchars(json_encode($this->debug_bloque33, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
  <?php } ?>
  <?php if (isset($this->debug_bloque34)) { ?>
    <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B34: <?php echo htmlspecialchars(json_encode($this->debug_bloque34, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
  <?php } ?>
  <?php if (isset($this->debug_bloque35)) { ?>
    <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B35: <?php echo htmlspecialchars(json_encode($this->debug_bloque35, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
  <?php } ?>
<?php } ?>

<?php if (!empty($this->login_banner1)) { ?>
  <div style="position:relative;max-width:100%;overflow:hidden;margin:0; height:140px;">
    <?php $href1 = isset($this->login_banner1_link) ? trim((string)$this->login_banner1_link) : ''; ?>
    <?php if ($href1) { ?><a href="<?php echo htmlspecialchars($href1); ?>" style="display:block; height:100%;"><?php } ?>
    <img src="<?php echo htmlspecialchars($this->login_banner1); ?>" style="width:100%;height:100%;display:block;object-fit:cover;object-position:center;" />
    <?php if ($href1) { ?></a><?php } ?>
  </div>
<?php } else { ?>
  <div style="position:relative;max-width:100%;overflow:hidden;margin:0; height:140px; border-radius:8px; background:linear-gradient(180deg,#eef5fb 0%,#e6eef7 100%); border:1px solid #d9e5f0; box-shadow:0 6px 18px rgba(15,23,42,0.05);"></div>
<?php } ?>

<?php if (!empty($this->login_banner2)) { ?>
  <div style="max-width:360px;margin:12px auto 8px;text-align:center;">
    <?php $href2 = isset($this->login_banner2_link) ? trim((string)$this->login_banner2_link) : ''; ?>
    <?php if ($href2) { ?><a href="<?php echo htmlspecialchars($href2); ?>" style="display:inline-block;">
    <?php } ?>
    <img src="<?php echo htmlspecialchars($this->login_banner2); ?>" style="width:100%;height:auto;display:block;border-radius:12px;" />
    <?php if ($href2) { ?></a><?php } ?>
  </div>
<?php } else { ?>
  <div style="max-width:360px;margin:12px auto 8px;text-align:center;">
    <div style="width:100%; min-height:140px; border-radius:12px; background:#eef3f7; border:1px solid #d9e5f0; box-shadow:0 6px 18px rgba(15,23,42,0.05);"></div>
  </div>
<?php } ?>

<form method="post" id="frm_nuevo" style="max-width:390px; margin:24px auto; padding:26px 24px; background:#fff; border-radius:20px; text-align:center;">

  <div class="login-header">
    <h2 class="login-title">Iniciar Sesión</h2>
    <div class="login-sub">Ingresa con tu correo y contraseña</div>
  </div>

  <!-- Input correo -->
  <div class="field">
    <i class="fa-regular fa-envelope field-ico" aria-hidden="true"></i>
    <input type="email" name="email" id="email" placeholder="Correo electrónico" required
      style="background:#f9fafb;">
  </div>

  <!-- Input contraseña con ojito -->
  <div class="field">
    <i class="fa-solid fa-lock field-ico" aria-hidden="true"></i>
    <input type="password" name="password" id="password" placeholder="Contraseña" required
      style="background:#f9fafb;">
    <button type="button" class="toggle-password" onclick="togglePassword()" aria-label="Mostrar u ocultar contraseña"
      style="position:absolute; right:10px; top:50%; transform:translateY(-50%); border:0; background:transparent; padding:6px; cursor:pointer; color:#6b7280;">
      <i class="far fa-eye" aria-hidden="true"></i>
    </button>
  </div>

  <?php if (isset($this->_error)): ?>
    <div style="color: red; font-size: 14px; margin: 10px 0;">&nbsp;<?php echo $this->_error; ?></div>
  <?php endif; ?>

  <input type="hidden" value="1" name="enviar" />

  <!-- Botón -->
  <button type="submit" name="Submit" 
    class="btn-login"
    style="width:100%; background:#00bcd4; color:#fff; border:none; padding:12px 16px; border-radius:16px; font-size:16px; cursor:pointer; margin-top:14px; font-family:'Nunito',sans-serif; font-weight:900; box-shadow:0 18px 50px rgba(0,188,212,0.22); outline:3px solid rgba(0,188,212,0.14); outline-offset:3px;">
    Iniciar Sesión
  </button>

  <!-- Link registro -->
  <p style="margin-top: 15px; font-size: 13px; color: #666;">
    ¿No tienes cuenta? <a href="<?php echo BASE_URL; ?>login/registro" style="color: #00bcd4; text-decoration: none; font-weight: bold;">Regístrate</a>
  </p>
</form>


<?php /* segunda imagen ya se muestra arriba como imagen pequeña */ ?>

<?php 
  $help = isset($this->login_help) && is_array($this->login_help) ? $this->login_help : [];
  $waUrl = isset($this->login_help_link) && is_string($this->login_help_link) ? trim((string)$this->login_help_link) : '';
  $waMsg = isset($this->login_help_msg) && is_string($this->login_help_msg) ? trim((string)$this->login_help_msg) : '';
  $waNum = '';
  // fallback si no vino link directo
  if (!$waUrl) {
    $link0 = $help['link'][0] ?? '';
    if (is_string($link0)) { $waUrl = trim($link0); }
    // si no hay URL, intenta deducir número
    foreach ($help as $arr) {
      if (!is_array($arr)) continue;
      foreach ($arr as $val) {
        if (!is_string($val)) continue; $s=trim($val);
        if (!$waUrl && (stripos($s,'wa.me/')!==false || stripos($s,'whatsapp')!==false)) $waUrl=$s;
        if (!$waNum){ $d=preg_replace('/\D+/','',$s); if (strlen($d)>=8) $waNum=$d; }
      }
    }
  }
  if (!$waUrl && $waNum) { $waUrl = 'https://wa.me/'.$waNum; }
  if ($waUrl && stripos($waUrl,'http') !== 0) { $waUrl = 'https://'.$waUrl; }
  if ($waUrl && $waMsg) {
    if (stripos($waUrl,'wa.me/')!==false || stripos($waUrl,'api.whatsapp.com')!==false) {
      if (stripos($waUrl,'?text=')===false && stripos($waUrl,'&text=')===false) {
        $waUrl .= (strpos($waUrl,'?')===false ? '?' : '&').'text='.rawurlencode($waMsg);
      }
    }
  }
?>
<div style="text-align:center; margin: 16px 0 24px; display:flex; align-items:center; justify-content:center; gap:10px;">
  <div style="font-size:20px;font-weight:800;color:#0f172a;">¿Necesitas ayuda? Escríbenos</div>
  <?php if (!empty($waUrl)) { ?>
    <a href="<?php echo htmlspecialchars($waUrl); ?>" target="_blank" rel="noopener" aria-label="WhatsApp" style="display:inline-flex; align-items:center; justify-content:center; width:38px; height:38px; border-radius:50%; background:#25D366; color:#fff; text-decoration:none;">
      <i class="fab fa-whatsapp" style="font-size:20px;"></i>
    </a>
  <?php } else { ?>
    <span style="display:inline-block; width:38px; height:38px; border-radius:50%; background:#dfe7f0; border:1px solid #cfd9e4;"></span>
  <?php } ?>
</div>

<script>
  function togglePassword() {
    const pwd = document.getElementById("password");
    const btn = document.querySelector("#frm_nuevo .toggle-password");
    const icon = btn ? btn.querySelector('i') : null;
    const isHidden = pwd.type === "password";
    pwd.type = isHidden ? "text" : "password";
    if (icon) {
      icon.classList.toggle('fa-eye', !isHidden);
      icon.classList.toggle('fa-eye-slash', isHidden);
    }
  }
</script>
</div>

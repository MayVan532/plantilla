<div class="personas-main-content" style="background:#ffffff;">
  <style>
    .personas-main-content{background:linear-gradient(180deg,#f6fbff 0%,#ffffff 55%,#f7fafc 100%) !important;}

    #frm_registro{border:1px solid rgba(2,132,199,0.10) !important;}
    #frm_registro{box-shadow:0 18px 55px rgba(15,23,42,0.18) !important;}
    #frm_registro{backdrop-filter:saturate(130%) blur(6px);}
    #frm_registro{overflow:hidden;}

    #frm_registro > div:first-child{background:linear-gradient(90deg,#00bcd4 0%,#06b6d4 35%,#22c55e 100%) !important;}

    #frm_registro input[type="text"],
    #frm_registro input[type="email"],
    #frm_registro input[type="password"]{
      border:1px solid #e5e7eb !important;
      background:linear-gradient(180deg,#ffffff 0%,#fbfdff 100%) !important;
      box-shadow:0 1px 0 rgba(15,23,42,0.02) !important;
      transition:border-color .15s ease, box-shadow .15s ease, transform .06s ease;
    }

    #frm_registro input[type="text"]:focus,
    #frm_registro input[type="email"]:focus,
    #frm_registro input[type="password"]:focus{
      border-color:rgba(0,188,212,0.95) !important;
      box-shadow:0 0 0 4px rgba(0,188,212,0.18) !important;
      background:#ffffff !important;
    }

    #frm_registro button[type="submit"]{
      transition:transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }

    #frm_registro button[type="submit"]:hover{
      filter:brightness(1.03);
      transform:translateY(-1px);
      box-shadow:0 16px 40px rgba(0,188,212,0.55) !important;
    }

    #frm_registro button[type="submit"]:active{
      transform:translateY(0);
      filter:brightness(0.98);
    }

    #frm_registro [data-toggle-password]{
      border-radius:10px;
      transition:background-color .12s ease, color .12s ease;
    }

    #frm_registro [data-toggle-password]:hover{
      background:rgba(148,163,184,0.18);
      color:#0f172a !important;
    }
  </style>
  <?php if (isset($_GET['debugcms']) && $_GET['debugcms']=='1') { ?>
    <?php if (isset($this->debug_pending_register)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">PENDING RESET (before): <?php echo htmlspecialchars(json_encode($this->debug_pending_register, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_pending_register_after)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">PENDING RESET (after): <?php echo htmlspecialchars(json_encode($this->debug_pending_register_after, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_bloque33)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B33: <?php echo htmlspecialchars(json_encode($this->debug_bloque33, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_bloque34)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B34: <?php echo htmlspecialchars(json_encode($this->debug_bloque34, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_bloque35)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">B35: <?php echo htmlspecialchars(json_encode($this->debug_bloque35, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_otp)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">OTP DEBUG: <?php echo htmlspecialchars(json_encode($this->debug_otp, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_auth_api)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">AUTH DEBUG: <?php echo htmlspecialchars(json_encode($this->debug_auth_api, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
    <?php if (isset($this->debug_register_api)) { ?>
      <pre style="background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;font-size:12px;padding:10px;border-radius:6px;margin:10px 0;white-space:pre-wrap;">REGISTER DEBUG: <?php echo htmlspecialchars(json_encode($this->debug_register_api, JSON_PRETTY_PRINT|JSON_UNESCAPED_SLASHES)); ?></pre>
    <?php } ?>
  <?php } ?>

  <?php if (!empty($this->login_banner1)) { ?>
    <div style="position:relative;max-width:100%;overflow:hidden;margin:0; height:140px;">
      <?php $href1 = isset($this->login_banner1_link) ? trim((string)$this->login_banner1_link) : ''; ?>
      <?php if ($href1) { ?><a href="<?php echo htmlspecialchars($href1); ?>" style="display:block; height:100%;"><?php } ?>
      <img src="<?php echo htmlspecialchars($this->login_banner1); ?>" style="width:100%;height:100%;display:block;object-fit:cover;object-position:center;" />
      <?php if ($href1) { ?></a><?php } ?>
    </div>
  <?php } else { ?>
    <div style="position:relative;max-width:100%;overflow:hidden;margin:0; height:140px; border-radius:8px; background:linear-gradient(180deg,#eef5fb 0%,#e6eef7 100%); border:1px solid #d9e5f0; box-shadow:0 6px 18px rgba(15,23,42,0.05);"></div>
  <?php } ?>

  <?php if (!empty($this->login_banner2)) { ?>
    <div style="max-width:360px;margin:12px auto 8px;text-align:center;">
      <?php $href2 = isset($this->login_banner2_link) ? trim((string)$this->login_banner2_link) : ''; ?>
      <?php if ($href2) { ?><a href="<?php echo htmlspecialchars($href2); ?>" style="display:inline-block;">
      <?php } ?>
      <img src="<?php echo htmlspecialchars($this->login_banner2); ?>" style="width:100%;height:auto;display:block;border-radius:12px;" />
      <?php if ($href2) { ?></a><?php } ?>
    </div>
  <?php } else { ?>
    <div style="max-width:360px;margin:12px auto 8px;text-align:center;">
      <div style="width:100%; min-height:140px; border-radius:12px; background:#eef3f7; border:1px solid #d9e5f0; box-shadow:0 6px 18px rgba(15,23,42,0.05);"></div>
    </div>
  <?php } ?>

  <div style="max-width:800px; margin:32px auto; padding:0 16px; display:flex; flex-wrap:wrap; gap:32px; justify-content:center;">
    <div style="flex:1 1 220px; text-align:center;">
      <div style="max-width:320px; margin:0 auto; padding:26px 20px 28px; min-height:260px; border-radius:20px; background:rgba(255,255,255,0.9); border:1px solid rgba(2,132,199,0.10); box-shadow:0 14px 40px rgba(15,23,42,0.10);">
        <h2 style="margin:10px 0 18px; color:#0f172a; font-size:28px; font-weight:900; font-family:'Nunito',sans-serif; letter-spacing:-0.02em;">
          Ya tengo cuenta
        </h2>
        <div style="color:#475569; font-size:13px; line-height:1.8; margin-bottom:22px;">
          Inicia sesión para administrar tu cuenta y consultar tus beneficios.
        </div>
        <a href="<?php echo BASE_URL; ?>login" style="display:inline-flex; align-items:center; justify-content:center; width:100%; padding:10px 16px; border-radius:16px; background:#00bcd4; color:#fff; font-weight:900; text-decoration:none; font-size:14px; border:2px solid rgba(15,23,42,0.10); outline:3px solid rgba(0,188,212,0.18); outline-offset:3px; margin-top:2px;">
          Iniciar Sesión
        </a>
      </div>
    </div>

    <div style="flex:1 1 260px; max-width:360px; padding:10px; border-radius:24px;">
      <!-- Card estilo formulario de contacto -->
      <form method="post" id="frm_registro" style="background:#ffffff; border-radius:18px; box-shadow:0 8px 24px rgba(15,23,42,0.12); overflow:hidden;">
        <!-- Cabecera turquesa -->
        <div style="background:#00bcd4; padding:18px 22px;">
          <h2 style="margin:0; color:#ffffff; font-size:24px; font-weight:800; font-family:'Nunito',sans-serif; text-align:center;">
            Crear cuenta
          </h2>
        </div>

        <!-- Contenido del formulario -->
        <div style="padding:20px 22px 22px;">
          <p style="margin:0 0 14px; font-size:13px; line-height:1.5; color:#4b5563;">
            Completa el formulario para crear tu cuenta y comenzar a disfrutar tus beneficios.
          </p>

          <?php if (isset($this->_error) && $this->_error) { ?>
            <div id="registerErrorOverlay" style="position:fixed; inset:0; background:rgba(15,23,42,0.78); display:flex; align-items:center; justify-content:center; padding:20px; z-index:10000;">
              <div role="dialog" aria-modal="true" style="width:100%; max-width:520px; background:#ffffff; border-radius:18px; box-shadow:0 24px 80px rgba(15,23,42,0.35); border:1px solid rgba(220,38,38,0.18); overflow:hidden;">
                <div style="padding:16px 18px; background:linear-gradient(90deg,#ef4444 0%,#f97316 100%); color:#ffffff; font-weight:800; font-size:14px; display:flex; justify-content:space-between; align-items:center;">
                  <div>Error</div>
                  <button type="button" id="registerErrorClose" style="border:none; background:rgba(255,255,255,0.18); color:#ffffff; border-radius:10px; padding:6px 10px; font-weight:800; cursor:pointer;">Cerrar</button>
                </div>
                <div style="padding:18px 18px 20px;">
                  <div style="display:flex; gap:12px; align-items:flex-start;">
                    <div style="width:42px; height:42px; border-radius:999px; background:rgba(239,68,68,0.10); display:flex; align-items:center; justify-content:center; border:1px solid rgba(239,68,68,0.25); flex:0 0 auto;">
                      <i class="fas fa-times" style="color:#dc2626;"></i>
                    </div>
                    <div style="flex:1;">
                      <div style="font-size:16px; font-weight:900; color:#0f172a; margin-bottom:6px;">No se pudo completar</div>
                      <div style="font-size:13px; color:#475569; line-height:1.6;">
                        <?php echo htmlspecialchars((string)$this->_error); ?>
                      </div>
                      <div style="margin-top:12px; font-size:12px; color:#64748b;">Este mensaje se cerrará automáticamente.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <script>
              (function(){
                var overlay = document.getElementById('registerErrorOverlay');
                var closeBtn = document.getElementById('registerErrorClose');
                var prevOverflow = '';
                try {
                  if (overlay && overlay.parentNode && overlay.parentNode !== document.body) {
                    document.body.appendChild(overlay);
                  }
                } catch (e) {}
                try {
                  prevOverflow = document.body.style.overflow || '';
                  document.body.style.overflow = 'hidden';
                } catch (e) {}
                function close(){
                  if (!overlay) return;
                  overlay.style.display = 'none';
                  try { document.body.style.overflow = prevOverflow; } catch (e) {}
                }
                if (closeBtn) closeBtn.addEventListener('click', close);
                if (overlay) overlay.addEventListener('click', function(e){
                  if (e.target === overlay) close();
                });
                window.setTimeout(close, 4500);
              })();
            </script>
          <?php } ?>

          <?php if (isset($this->_success) && $this->_success) { ?>
            <div id="registerSuccessOverlay" style="position:fixed; inset:0; background:rgba(15,23,42,0.55); display:flex; align-items:center; justify-content:center; padding:20px; z-index:9999;">
              <div role="dialog" aria-modal="true" style="width:100%; max-width:520px; background:#ffffff; border-radius:18px; box-shadow:0 24px 80px rgba(15,23,42,0.35); border:1px solid rgba(2,132,199,0.12); overflow:hidden;">
                <div style="padding:16px 18px; background:linear-gradient(90deg,#00bcd4 0%,#06b6d4 35%,#22c55e 100%); color:#ffffff; font-weight:800; font-size:14px; display:flex; justify-content:space-between; align-items:center;">
                  <div>Registro</div>
                  <button type="button" id="registerSuccessClose" style="border:none; background:rgba(255,255,255,0.18); color:#ffffff; border-radius:10px; padding:6px 10px; font-weight:800; cursor:pointer;">Cerrar</button>
                </div>
                <div style="padding:18px 18px 20px;">
                  <div style="display:flex; gap:12px; align-items:flex-start;">
                    <div style="width:42px; height:42px; border-radius:999px; background:rgba(34,197,94,0.12); display:flex; align-items:center; justify-content:center; border:1px solid rgba(34,197,94,0.25); flex:0 0 auto;">
                      <i class="fas fa-check" style="color:#16a34a;"></i>
                    </div>
                    <div style="flex:1;">
                      <div style="font-size:16px; font-weight:900; color:#0f172a; margin-bottom:6px;">Registro exitoso</div>
                      <div style="font-size:13px; color:#475569; line-height:1.6;">
                        <?php echo htmlspecialchars((string)$this->_success); ?>
                      </div>
                      <div style="margin-top:12px; font-size:12px; color:#64748b;">Este mensaje se cerrará automáticamente.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <script>
              (function(){
                var overlay = document.getElementById('registerSuccessOverlay');
                var closeBtn = document.getElementById('registerSuccessClose');
                function close(){
                  if (!overlay) return;
                  overlay.style.display = 'none';
                }
                if (closeBtn) closeBtn.addEventListener('click', close);
                if (overlay) overlay.addEventListener('click', function(e){
                  if (e.target === overlay) close();
                });
                window.setTimeout(close, 3000);
              })();
            </script>
          <?php } ?>

          <?php if (isset($this->redirect_url) && is_string($this->redirect_url) && $this->redirect_url !== '') { ?>
            <?php $secs = isset($this->redirect_seconds) ? (int)$this->redirect_seconds : 3; if ($secs <= 0) { $secs = 3; } ?>
            <script>
              (function(){
                var url = <?php echo json_encode((string)$this->redirect_url); ?>;
                var ms = <?php echo (int)$secs; ?> * 1000;
                setTimeout(function(){ window.location.href = url; }, ms);
              })();
            </script>
          <?php } ?>

          <?php $pending = isset($this->pending_register) && is_array($this->pending_register) ? $this->pending_register : null; ?>
          <?php if (!$pending) { ?>
            <input type="hidden" name="enviar_otp" value="1">

          <input type="text" name="nombre" placeholder="Nombre(s)" required
            style="width:100%; padding:10px 14px; margin:6px 0; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">
          <input type="text" name="apellido_paterno" placeholder="Apellido Paterno" required
            style="width:100%; padding:10px 14px; margin:6px 0; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">
          <input type="text" name="apellido_materno" placeholder="Apellido Materno"
            style="width:100%; padding:10px 14px; margin:6px 0; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">
          <input type="email" name="email" placeholder="Correo electrónico" required
            style="width:100%; padding:10px 14px; margin:6px 0; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">

          <div style="position:relative;">
            <input type="password" id="reg_password" name="password" placeholder="Contraseña" required
              style="width:100%; padding:10px 42px 10px 14px; margin:6px 0; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">
            <button type="button" data-toggle-password="reg_password" aria-label="Mostrar u ocultar contraseña"
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); border:0; background:transparent; padding:6px; cursor:pointer; color:#6b7280;">
              <i class="far fa-eye" aria-hidden="true"></i>
            </button>
          </div>
          <div style="position:relative;">
            <input type="password" id="reg_password2" name="password2" placeholder="Repetir Contraseña" required
              style="width:100%; padding:10px 42px 10px 14px; margin:6px 0; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">
            <button type="button" data-toggle-password="reg_password2" aria-label="Mostrar u ocultar repetir contraseña"
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); border:0; background:transparent; padding:6px; cursor:pointer; color:#6b7280;">
              <i class="far fa-eye" aria-hidden="true"></i>
            </button>
          </div>
          <input type="text" name="telefono" placeholder="Teléfono" required
            inputmode="numeric" autocomplete="tel" maxlength="10" pattern="[0-9]{10}"
            oninput="this.value=this.value.replace(/\D+/g,'').slice(0,10);"
            style="width:100%; padding:10px 14px; margin:6px 0 16px; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">

          <input type="text" name="codigo_convenio" placeholder="Código de convenio (opcional)"
            style="width:100%; padding:10px 14px; margin:6px 0 16px; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb;">

          <div style="text-align:center; margin-top:6px;">
            <button type="submit" name="Submit" 
              style="min-width:150px; background:#00bcd4; color:#fff; border:none; padding:10px 28px; border-radius:6px; font-size:15px; cursor:pointer; font-weight:700; box-shadow:0 10px 30px rgba(0,188,212,0.45);">
              Enviar código
            </button>
          </div>

          <?php } else { ?>
            <?php
              $sentAt = isset($pending['otp_sent_at']) ? (int)$pending['otp_sent_at'] : 0;
              $msisdn = isset($pending['numero_telefono']) ? (string)$pending['numero_telefono'] : '';
              $masked = $msisdn;
              if (strlen($masked) >= 10) {
                $masked = substr($masked, 0, 2).'******'.substr($masked, -2);
              }
            ?>

            <div style="margin:10px 0 12px; padding:10px 12px; border-radius:12px; background:#f8fafc; border:1px solid #e2e8f0; color:#0f172a; font-size:13px;">
              Enviamos un código al teléfono <strong><?php echo htmlspecialchars($masked); ?></strong>
            </div>

            <div style="margin:8px 0 14px; text-align:right;">
              <a href="<?php echo BASE_URL; ?>registro?reset=1" style="display:inline-block; font-size:13px; color:#64748b; text-decoration:none; font-weight:800;">
                Volver a intentar
              </a>
            </div>

            <input type="hidden" name="validar_otp" value="1">
            <input type="text" name="codigo" placeholder="Código" required
              inputmode="numeric" maxlength="6"
              oninput="this.value=this.value.replace(/\D+/g,'').slice(0,6);"
              style="width:100%; padding:10px 14px; margin:6px 0 10px; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none; background:#f9fafb; text-align:center; letter-spacing:.3em; font-weight:800;">

            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin:8px 0 16px;">
              <div style="font-size:13px; color:#475569;">
                Expira en <span id="otpTimer" style="font-weight:900; color:#0f172a;">05:00</span>
              </div>
              <button type="button" id="btnResend" style="border:0; background:transparent; color:#00bcd4; font-weight:800; cursor:pointer; padding:6px 0;">
                Reenviar
              </button>
            </div>

            <input type="hidden" name="resend_otp" id="resend_otp" value="0">

            <div style="text-align:center; margin-top:6px;">
              <button type="submit" name="Submit"
                style="min-width:150px; background:#00bcd4; color:#fff; border:none; padding:10px 28px; border-radius:6px; font-size:15px; cursor:pointer; font-weight:700; box-shadow:0 10px 30px rgba(0,188,212,0.45);">
                Verificar y crear cuenta
              </button>
            </div>

            <script>
              (function(){
                var sentAt = <?php echo (int)$sentAt; ?>;
                var expiresAt = (sentAt > 0 ? (sentAt + 300) : 0);
                var timerEl = document.getElementById('otpTimer');
                var btn = document.getElementById('btnResend');
                var resendInput = document.getElementById('resend_otp');
                var mainForm = document.getElementById('frm_registro');

                function fmt(n){ return (n<10?'0':'')+n; }
                function tick(){
                  if (!timerEl || !expiresAt) return;
                  var now = Math.floor(Date.now()/1000);
                  var left = expiresAt - now;
                  if (left < 0) left = 0;
                  var mm = Math.floor(left/60);
                  var ss = left%60;
                  timerEl.textContent = fmt(mm)+':'+fmt(ss);
                }
                tick();
                setInterval(tick, 1000);

                if (btn && resendInput && mainForm) {
                  btn.addEventListener('click', function(){
                    resendInput.value = '1';
                    mainForm.submit();
                  });
                }
              })();
            </script>
          <?php } ?>
        </div>
      </form>
    </div>
  </div>

  <?php 
    $help = isset($this->login_help) && is_array($this->login_help) ? $this->login_help : [];
    $waUrl = isset($this->login_help_link) && is_string($this->login_help_link) ? trim((string)$this->login_help_link) : '';
    $waMsg = isset($this->login_help_msg) && is_string($this->login_help_msg) ? trim((string)$this->login_help_msg) : '';
    $waNum = '';
    if (!$waUrl) {
      $link0 = $help['link'][0] ?? '';
      if (is_string($link0)) { $waUrl = trim($link0); }
      foreach ($help as $arr) {
        if (!is_array($arr)) continue;
        foreach ($arr as $val) {
          if (!is_string($val)) continue; $s=trim($val);
          if (!$waUrl && (stripos($s,'wa.me/')!==false || stripos($s,'whatsapp')!==false)) $waUrl=$s;
          if (!$waNum){ $d=preg_replace('/\D+/','',$s); if (strlen($d)>=8) $waNum=$d; }
        }
      }
    }
    if (!$waUrl && $waNum) { $waUrl = 'https://wa.me/'.$waNum; }
    if ($waUrl && stripos($waUrl,'http') !== 0) { $waUrl = 'https://'.$waUrl; }
    if ($waUrl && $waMsg) {
      if (stripos($waUrl,'wa.me/')!==false || stripos($waUrl,'api.whatsapp.com')!==false) {
        if (stripos($waUrl,'?text=')===false && stripos($waUrl,'&text=')===false) {
          $waUrl .= (strpos($waUrl,'?')===false ? '?' : '&').'text='.rawurlencode($waMsg);
        }
      }
    }
  ?>
  <div style="text-align:center; margin: 16px 0 24px; display:flex; align-items:center; justify-content:center; gap:10px;">
    <div style="font-size:20px;font-weight:800;color:#0f172a;">¿Necesitas ayuda? Escríbenos</div>
    <?php if (!empty($waUrl)) { ?>
      <a href="<?php echo htmlspecialchars($waUrl); ?>" target="_blank" rel="noopener" aria-label="WhatsApp" style="display:inline-flex; align-items:center; justify-content:center; width:38px; height:38px; border-radius:50%; background:#25D366; color:#fff; text-decoration:none;">
        <i class="fab fa-whatsapp" style="font-size:20px;"></i>
      </a>
    <?php } else { ?>
      <span style="display:inline-block; width:38px; height:38px; border-radius:50%; background:#dfe7f0; border:1px solid #cfd9e4;"></span>
    <?php } ?>
  </div>

  <script>
    (function () {
      function togglePassword(button) {
        var inputId = button.getAttribute('data-toggle-password');
        if (!inputId) return;
        var input = document.getElementById(inputId);
        if (!input) return;

        var isHidden = input.type === 'password';
        input.type = isHidden ? 'text' : 'password';

        var icon = button.querySelector('i');
        if (icon) {
          icon.classList.toggle('fa-eye', !isHidden);
          icon.classList.toggle('fa-eye-slash', isHidden);
        }
      }

      document.addEventListener('click', function (e) {
        var btn = e.target && e.target.closest ? e.target.closest('[data-toggle-password]') : null;
        if (!btn) return;
        togglePassword(btn);
      });
    })();
  </script>
</div>
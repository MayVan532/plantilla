<?php
  // Datos mapeados por el controlador: lc_contacto_social (byType) y lc_contacto_links (fallback)
  $by = $this->lc_contacto_social ?? [];
  $links = $this->lc_contacto_links ?? [];

  $email = '';$emailHref='';
  $wa = '';$waHref='';
  $phone = '';$phoneHref = null; // ocultar teléfono si no se provee

  // Email
  $correo = $by['email'][0] ?? ($by['correo'][0] ?? null);
  if (!$correo && is_array($links)) {
    foreach ($links as $row) {
      $ic = strtolower((string)($row['icon'] ?? ''));
      if (strpos($ic,'email')!==false || strpos($ic,'correo')!==false || strpos($ic,'envelope')!==false) { $correo = $row['url'] ?? ''; break; }
    }
  }
  if ($correo) { 
    $emailHref = stripos($correo,'mailto:')===0 ? $correo : ('mailto:' . $correo);
    $email = preg_replace('#^mailto:#i','',$emailHref);
  }

  // WhatsApp
  $wa = $by['whatsapp'][0] ?? ($by['wa'][0] ?? null);
  if (!$wa && is_array($links)) {
    foreach ($links as $row) {
      $ic = strtolower((string)($row['icon'] ?? ''));
      if (strpos($ic,'whatsapp')!==false || $ic==='wa') { $wa = $row['url'] ?? ''; break; }
    }
  }
  $waHref = $wa ?: '';
?>
<div class="likecheck-main-content">
    <?php if (!empty($_GET['debugcms'])) { ?>
      <pre style="background:#000;color:#0f0;padding:8px;font-size:11px;">
byType: <?php var_export($by); ?>
links: <?php var_export($links); ?>
email=<?php echo htmlspecialchars($email); ?> emailHref=<?php echo htmlspecialchars($emailHref); ?>
wa=<?php echo htmlspecialchars((string)$wa); ?> waHref=<?php echo htmlspecialchars((string)$waHref); ?>
rows: <?php if (isset($this->lc_contacto_debug_rows)) { var_export($this->lc_contacto_debug_rows); } ?>
      </pre>
    <?php } ?>
    <div class="section-container active" id="contactanos-content" style="padding: 0; background: #ffffff; overflow: hidden;">
        <!-- TITULO -->
        <p style="font-size: 3.2rem; font-weight: 900; color: #3C467B; text-align: center; margin-bottom: 10px; letter-spacing: 1px; margin-top: 35px;">
            CONTACTANOS, TU OPINION IMPORTA</span>
        </p>
        <div class="row g-0" style="min-height: 100vh;">
            <div class="col-md-6" style="background-color: #1e2a7a; padding: 60px 30px; position: relative; height: 100%;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3 style="color: white; font-weight: 700; font-size: 1.5rem; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">¡NO PIERDAS NI UN MINUTO MÁS!</h3>
                    <p style="color: #00c2cb; font-size: 1.8rem; font-weight: 600; margin: 0; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">¡CONTÁCTANOS!</p>
                </div>
                <iframe name="hidden_iframe" style="display:none;"></iframe>
                <form id="contact-form" style="max-width: 400px; margin: 0 auto;" class="needs-validation" novalidate
                    target="hidden_iframe"
                    method="GET"
                    action="https://script.google.com/macros/s/AKfycby0BmQKyeEuOEiw1z-ghLjBxObWioApsgmN4Te00JxYFqOa2Sp87sNgcXk2_Tdp8I3N/exec">
                    <div class="form-group mb-4 input-with-icon">
                        <i class="fas fa-user elegant-icon"></i>
                        <input type="text" name="nombre" class="elegant-input" placeholder="Nombre completo" required>
                    </div>
                    <div class="form-group mb-4 input-with-icon">
                        <i class="fas fa-phone-alt elegant-icon"></i>
                        <input type="tel" name="telefono" class="elegant-input" placeholder="Teléfono" required pattern="\d{10}" maxlength="10" inputmode="numeric" title="Ingresa 10 dígitos numéricos">
                    </div>
                    <div class="form-group mb-4 input-with-icon">
                        <i class="fas fa-envelope elegant-icon"></i>
                        <input type="email" name="correo" class="elegant-input" placeholder="Correo" required>
                    </div>
                    <div class="form-group mb-4 input-with-icon">
                        <i class="fas fa-building elegant-icon"></i>
                        <input type="text" name="empresa" class="elegant-input uppercase" placeholder="Empresa" required>
                    </div>
                    <div class="form-group mb-4 input-with-icon">
                        <i class="fas fa-tag elegant-icon"></i>
                        <input type="text" name="giro" class="elegant-input uppercase" placeholder="Giro" required>
                    </div>
                    <div class="form-group mb-4 input-with-icon">
                        <i class="fas fa-users elegant-icon"></i>
                        <input type="number" name="empleados" class="elegant-input" placeholder="Número de empleados" required>
                    </div>
                    <button type="submit" class="elegant-button">Enviar datos</button>
                </form>
            </div>
            <div class="col-md-6" style="background-color: #f2f5fa; padding: 30px 30px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div class="text-center mb-4">
                    <h3 style="font-size: 2rem; color: #1e2a7a; font-weight: 700; font-family: 'Montserrat', sans-serif; margin-bottom: 10px;">
                        ¿TIENES DUDAS?
                    </h3>
                    <p style="font-size: 1.3rem; color: #1e2a7a; margin-bottom: 30px;">Comunícate con nosotros de<br>inmediato</p>
                </div>
                <div style="background-color: white; width: 100%; max-width: 370px; padding: 15px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; transition: all 0.3s ease; border-left: 4px solid #00c2cb;">
                    <div class="d-flex align-items-center">
                        <div style="background-color: #00c2cb; width: 45px; height: 45px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-envelope" style="color: white; font-size: 1.2rem;"></i>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.85rem; color: #666; text-transform: uppercase;">CORREO ELECTRÓNICO</span>
                            <?php if ($emailHref) { ?>
                              <a href="<?php echo htmlspecialchars($emailHref); ?>" style="font-size: 1.1rem; color: #1e2a7a; text-decoration: none; font-family: 'Montserrat', sans-serif; font-weight: 600;">
                                <?php echo htmlspecialchars($email ?: ''); ?>
                              </a>
                            <?php } else { ?>
                              <div style="height:14px;width:220px;background:#eef2f7;border-radius:6px;"></div>
                            <?php } ?>
                        </div>
                    </div>
                </div>
                <?php if ($phoneHref) { ?>
                  <div style="background-color: white; width: 100%; max-width: 370px; padding: 15px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; transition: all 0.3s ease; border-left: 4px solid #1e2a7a;">
                      <div class="d-flex align-items-center">
                          <div style="background-color: #00c2cb; width: 45px; height: 45px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                              <i class="fas fa-phone-alt" style="color: white; font-size: 1.2rem;"></i>
                          </div>
                          <div>
                              <span style="display: block; font-size: 0.85rem; color: #666; text-transform: uppercase;">TELÉFONO</span>
                              <a href="<?php echo htmlspecialchars($phoneHref); ?>" style="font-size: 1.1rem; color: #1e2a7a; text-decoration: none; font-family: 'Montserrat', sans-serif; font-weight: 600;">
                                <?php echo htmlspecialchars($phone ?: ''); ?>
                              </a>
                          </div>
                      </div>
                  </div>
                <?php } ?>
                <div style="width: 100%; max-width: 370px; margin: 20px 0;">
                    <?php if ($waHref) { ?>
                      <a href="<?php echo htmlspecialchars($waHref); ?>" target="_blank" style="background-color: #25d366; color: white; border-radius: 50px; padding: 12px 25px; text-decoration: none; display: flex; align-items: center; justify-content: center; font-family: 'Montserrat', sans-serif; width: 100%; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.5); transition: transform 0.3s ease, box-shadow 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 20px rgba(37, 211, 102, 0.6)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(37, 211, 102, 0.5)'" onmousedown="this.style.transform='translateY(1px)';this.style.boxShadow='0 2px 10px rgba(37, 211, 102, 0.5)';" onmouseup="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 20px rgba(37, 211, 102, 0.6)';"><div>
                          <span style="display: block; font-size: 0.9rem; opacity: 0.9; text-align: center;">Respuesta inmediata</span>
                          <div style="display: flex; align-items: center; justify-content: center;">
                              <i class="fab fa-whatsapp" style="font-size: 1.5rem; margin-right: 10px;"></i>
                              <span style="font-size: 1.1rem; font-weight: 600;">WhatsApp Directo</span>
                          </div>
                          </div>
                      </a>
                    <?php } else { ?>
                      <div style="background-color:#c8e6c9; opacity:.6; color:#fff; border-radius: 50px; padding: 12px 25px; display:flex; align-items:center; justify-content:center; font-family: 'Montserrat', sans-serif; width: 100%; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.2);">
                        <span style="display:block; font-size: 0.9rem; opacity:.9; text-align:center;">WhatsApp</span>
                      </div>
                    <?php } ?>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <style>
            #contactanos-content .form-control:focus {
                box-shadow: 0 0 0 0.2rem rgba(0, 194, 203, 0.25);
                border-color: #00c2cb;
            }
            .input-with-icon {
                position: relative;
            }
            .input-with-icon i {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: #00c2cb;
                z-index: 1;
            }
            .input-with-icon input {
                padding-left: 55px !important;
            }
        </style>
        <style>
            .elegant-input {
                height: 50px;
                border-radius: 6px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                background-color: rgba(255, 255, 255, 0.08);
                width: 100%;
                padding: 10px;
                color: white;
                transition: all 0.3s ease;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(5px);
            }
            .elegant-input::placeholder {
                color: rgba(255, 255, 255, 0.7);
            }
            .elegant-input:focus {
                outline: none;
                border-color: #00c2cb;
                box-shadow: 0 0 0 2px rgba(0, 194, 203, 0.25);
                background-color: rgba(255, 255, 255, 0.12);
            }
            .elegant-icon {
                font-size: 1.4rem;
                color: #00f9ff;
                text-shadow: 0 0 5px rgba(0, 249, 255, 0.5);
                transition: all 0.3s ease;
                opacity: 0.9;
            }
            .elegant-button {
                background: linear-gradient(45deg, #00c2cb, #00a0bb);
                color: white;
                border-radius: 30px;
                padding: 15px 40px;
                font-weight: 600;
                border: none;
                width: 100%;
                margin-top: 20px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 194, 203, 0.3);
                text-transform: uppercase;
                letter-spacing: 1px;
                font-size: 0.9rem;
            }
            .elegant-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 18px rgba(0, 194, 203, 0.4);
            }
            .elegant-button:active {
                transform: translateY(1px);
                box-shadow: 0 2px 10px rgba(0, 194, 203, 0.3);
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('contact-form');
            const telefonoInput = form.querySelector('input[name="telefono"]');
                telefonoInput.addEventListener('input', function () {
                this.value = this.value.replace(/\D/g, '');
                });
                form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                form.classList.add('was-validated');
            return;
                }       
            const empresa = form.querySelector('input[name="empresa"]');
            const giro = form.querySelector('input[name="giro"]');
                empresa.value = empresa.value.toUpperCase();
                giro.value = giro.value.toUpperCase();                                                                   
                setTimeout(() => {
                Swal.fire({
                icon: 'success',
                title: '¡Listo!',
                text: 'Tus datos han sido enviados, en un momento te contactamos.',
                confirmButtonColor: '#00c2cb',
                confirmButtonText: 'Aceptar',
                backdrop: true
                });
                form.reset();
                form.classList.remove('was-validated');
                }, 1000);
                location.hash = "#contactanos-content";
                });
                });
            </script>
        </div>
    </div>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<?php 
  $by = $this->lc_inicio ?? [];
  $titulo = null; // Se omite en UI por requerimiento
  $subtitulo = null; // Se omite en UI por requerimiento
  $texto = $by['texto'][0] ?? null;
  $parrafo = $by['parrafo'][0] ?? null;
  $boton = $by['boton'][0] ?? null;
  $videoItem = $by['video'][0] ?? null;
  $videoSrc = null;
  if (is_array($videoItem)) {
    $videoSrc = $videoItem['video'] ?? ($videoItem['link'] ?? null);
  } elseif (is_string($videoItem)) {
    $videoSrc = $videoItem;
  }
  // Normalize YouTube watch/short links to embeddable URL
  $embedSrc = $videoSrc;
  if ($videoSrc) {
    if (preg_match('#(?:youtube\.com/watch\?v=|youtu\.be/)([A-Za-z0-9_-]{6,})#', (string)$videoSrc, $m)) {
      $vid = $m[1];
      $embedSrc = 'https://www.youtube.com/embed/' . $vid . '?rel=0&modestbranding=1';
    }
  }
  $has = ($titulo || $subtitulo || $texto || $parrafo || $boton || $videoSrc);
?>

<div style="width:100%; max-width:100%; margin:0; font-family:'Poppins',sans-serif; background-color:#ffffff; color:#1e2b4a;">
  <div style="width:100%; margin:0; padding:0;">
    <div style="width:100%; max-width:100%; margin:0; padding:0;">
      <div style="display:flex; flex-wrap:wrap; align-items:stretch; justify-content:center; padding:84px 6%; background:radial-gradient(circle at top left,#f3f8ff 0,#ffffff 45%); gap:52px;">
        <div style="flex:1 1 48%; min-width:340px; color:#1e2b4a; background:#ffffff; border-radius:24px; box-shadow:0 24px 54px rgba(15,23,42,0.18); padding:58px 42px; border:1px solid #e5edf7; display:flex; flex-direction:column; justify-content:center;">
          <?php if ($has) { ?>
            <?php if ($texto || $parrafo) { ?>
              <p style="font-size:1.35rem; line-height:2.2; color:#165f8f; margin:0; text-align:justify;">
                <?php 
                  $t1 = $texto ? (is_array($texto)?($texto['texto']??''):$texto) : '';
                  $t2 = $parrafo ? (is_array($parrafo)?($parrafo['parrafo']??''):$parrafo) : '';
                  $combined = trim($t1 . (strlen($t1) && strlen($t2) ? "\n" : '') . $t2);
                  $lines = preg_split('/\r?\n/', (string)$combined);
                  $seen = [];
                  $unique = [];
                  foreach ($lines as $ln) {
                    $norm = trim(preg_replace('/\s+/', ' ', $ln));
                    if ($norm === '') continue;
                    $key = mb_strtolower($norm, 'UTF-8');
                    if (!isset($seen[$key])) { $seen[$key]=1; $unique[]=$norm; }
                  }
                  echo nl2br(htmlspecialchars(implode("\n", $unique)));
                ?>
              </p>
            <?php } ?>
            <?php if ($boton) { 
              $btnText = is_array($boton)?($boton['boton']??''):$boton;
              $btnLink = is_array($boton)?($boton['link']??''):'';
              // Fallback: si no viene link en el elemento, usar el link expuesto por el controlador
              if ($btnLink === '' && isset($this->lc_inicio_btn_link) && is_string($this->lc_inicio_btn_link)) {
                $btnLink = $this->lc_inicio_btn_link;
              }
            ?>
              <a href="<?php echo htmlspecialchars((string)$btnLink); ?>"
                 target="_blank" rel="noopener"
                 style="display:inline-flex; align-items:center; justify-content:center; gap:8px; background:linear-gradient(45deg,#00c2cb,#00a0bb);
                        color:white; text-decoration:none; font-weight:600; padding:12px 22px; border-radius:10px;
                        margin-top:26px; transition:0.3s ease; box-shadow:0 4px 15px rgba(0,194,203,0.3); cursor:pointer; min-width:190px;">
                <?php echo htmlspecialchars((string)$btnText ?: 'AGENDAR'); ?> <i class="fas fa-chevron-right"></i>
              </a>
            <?php } ?>
          <?php } else { ?>
            <div style="height:16px; width:60%; background:#e3e8ee; border-radius:8px; margin:0 0 12px 0;"></div>
            <div style="height:12px; width:80%; background:#e9edf1; border-radius:6px; margin:6px 0;"></div>
            <div style="height:12px; width:70%; background:#e9edf1; border-radius:6px; margin:6px 0 20px;"></div>
            <div style="height:40px; width:220px; background:#cfd6dd; border-radius:50px;"></div>
          <?php } ?>
        </div>

        <div style="flex:1 1 48%; min-width:380px; display:flex; justify-content:center;">
          <div style="width:100%; max-width:820px; aspect-ratio:16/11; border-radius:26px; overflow:hidden;
                      box-shadow:0 24px 56px rgba(15,23,42,0.32); background:#020617;">
            <?php if ($embedSrc) { ?>
              <iframe src="<?php echo htmlspecialchars((string)$embedSrc); ?>"
                      title="LikeCheck Video"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen
                      style="width:100%; height:100%; border:none;"></iframe>
            <?php } ?>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
